Load some packages.

```{r include = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(languageR)
library(dplyr)
library(tidyr)
library(ggplot2)
library(lme4)
library(datasets)
library(ggpubr)
library(rstatix)
library(broom)
library(car)
```



Load data (utf8_220706_EN03_results.csv). Redo if source file changed. 
Make sure it's UTF-8!!!

```{r}
# load data. redo if source file changed. 
en03_results <- read.csv(file.choose(), 
                         header = TRUE, 
                         na.strings = "NA",
                         encoding = "UTF-8")
```



Check data.

```{r}
# open a panel to check the data file
View(en03_results)

# check summary of data
summary(en03_results)
```



Reorder factor level of target sounds.

```{r}
en03_results_new <- en03_results

# factor() converts a variable into a factor variable
# with the c() argument, it can also reorder factor level
# "p t k b d g" in this case
en03_results_new$target.sound <- factor(en03_results_new$target.sound,
                                        c("p", "t", "k", "b", "d", "g")
                                        )
en03_results_new$prev.sound.type <- factor(en03_results_new$prev.sound.type,
                                        c("vowel", "approximant", "appro/vow", "nasal", "consonant")
                                        )

```



Create some shorthand variables. (May not need these actually)

```{r}
dur_clo <- en03_results_new$duration_CLO
dur_bur <- en03_results_new$duration_BUR
dur_voi <- en03_results_new$duration_VOI
proportion_voi <- en03_results_new$VOI.CLO
proportion_bur <- en03_results_new$BUR.CLO
prev_sound_type <- en03_results_new$prev.sound.type
following_sound_type <- en03_results_new$following.sound.type
target <- en03_results$target.sound

```



Check dispersion & write into a file.

```{r}
# check dispersion of data. remember to REMOVE NA VALUES!!!
dispersion_en03 <- en03_results_new %>% 
  group_by(target.sound) %>%  
  summarise(mean_clo = mean(duration_CLO, na.rm = TRUE),
            sd_clo = sd(duration_CLO, na.rm = TRUE),
            mean_bur = mean(duration_BUR, na.rm = TRUE),
            sd_bur = sd(duration_BUR, na.rm = TRUE),
            mean_voi = mean(duration_VOI, na.rm = TRUE),
            sd_voi = mean(duration_VOI, na.rm = TRUE),
            mean_voiclo = mean(VOI.CLO, na.rm = TRUE),
            sd_voiclo = sd(VOI.CLO, na.rm = TRUE),
            mean_burclo = mean(BUR.CLO, na.rm = TRUE),
            sd_burclo = sd(BUR.CLO, na.rm = TRUE)
            )

# open a panel to check the dispersion table
View(dispersion_en03)

# export dispersion table to a csv file
write.csv(dispersion_en03, 
          file = "C:/Users/***/Desktop/R_working_dir/dispersion_en03.csv")

```



(base R) Make some quick box plots to check possible correlation.

```{r}
boxplot(VOI.CLO ~ target.sound, 
                            data = en03_results_new,
                            main = "dispersion of VOI/CLO value",
                            xlab = "target sound",
                            ylab = "VOI/CLO"
                            )

```



(ggplot2) Make box plots to check dispersion for: duration of closure, burst, voicing.

```{r}
box_clo <- ggplot(en03_results_new, aes(x = target.sound, y = duration_CLO, na.rm = TRUE)) + 
  geom_boxplot(fill = "gray", na.rm = TRUE) +
  labs(title = "Dispersion of closure duration", x = "Target sound", y = "Duration (sec)") + 
  theme_classic()

box_bur <- ggplot(en03_results_new, aes(x = target.sound, y = duration_BUR, na.rm = TRUE)) + 
  geom_boxplot(fill = "gray", na.rm = TRUE) + 
  labs(title = "Dispersion of burst duration", x = "Target sound", y = "Duration (sec)") + 
  theme_classic()

box_voi <- ggplot(en03_results_new, aes(x = target.sound, y = duration_VOI, na.rm = TRUE)) + 
  geom_boxplot(fill = "gray", na.rm = TRUE) + 
  labs(title = "Dispersion of voicing duration", x = "Target sound", y = "Duration (sec)") + 
  theme_classic()

box_voiclo <- ggplot(en03_results_new, aes(x = target.sound, y = VOI.CLO, na.rm = TRUE)) + 
  geom_boxplot(fill = "gray", na.rm = TRUE) + 
  labs(title = "Dispersion of VOI/CLO values", x = "Target sound", y= "VOI/CLO") + 
  theme_classic()

box_burclo <-ggplot(en03_results_new, aes(x = target.sound, y = BUR.CLO, na.rm = TRUE)) + 
  geom_boxplot(fill = "gray", na.rm = TRUE) +
  labs(title = "Dispersion of BUR/CLO values", x = "Target sound", y = "BUR/CLO") +
  theme_classic()

box_clo
box_bur
box_voi
box_voiclo
box_burclo

```



(Maybe later) Make stacked bar plots to show target sound contextual info.

```{r}

```



LME attempts. 
Syntax: model = lmer(target ~ fixed1 + fixed2 + (1|random1) + (1|random2), data=data) 
Still need: interpretation, data from multiple speakers (for random effects controlling etc.)

```{r}
model_voiclo1 = lmer(VOI.CLO ~ target.sound +  
                       (1|duration_VOI), 
             data = en03_results_new)
model_voiclo1
```

```{r}
model_voiclo2 = lmer(VOI.CLO ~ target.sound + prev.sound.type +  
                       (1|duration_VOI), 
             data = en03_results_new)
model_voiclo2
```



~~~~~~~~~~~~~~~~~~~~~~Obsolete parts~~~~~~~~~~~~~~~~~~~~~~~



(Obsolete) Make scatter plot with base R.

```{r}
# make a scatter plot for two CONTINUOUS NUMERICAL variables 
# with base R
# to check possible correlation
scatter.smooth(dur_voi, proportion_voi,
               main = "test title",
               xlab = "duration of voicing",
               ylab = "proportion of voicing"
                )
```



(Obsolete) Check covariance.

```{r}
# do a covariance between two CONTINUOUS NUMERICAL variables
# use Spearman here cuz Pearson just returns NA
# not sure why
rho1_spearman <- cor(en03_results_new$VOI.CLO, en03_results_new$word.syllable.total, 
                     use = "complete.obs",
                     method = "spearman")
print(rho1_spearman) 

```



(Obsolete) Analyse VOI/CLO.

```{r}
# step1: Leveneâ€™s test for the homogeneity of variance
# if p < 0.05, it is concluded that there is a difference 
# between the variances in the population
# and we can continue to do ANCOVA
leveneTest(VOI.CLO~target.sound, en03_results_new)

# step2: ANCOVA test 
# to see which variable contributes significantly 
# to the variance of voicing proportion
AncovaModel_VOI.CLO <- aov(VOI.CLO ~ target.sound + prev.sound.type + following.sound.type, 
                          data = en03_results_new)
Anova(AncovaModel_VOI.CLO, type="III")

# step3: pairwise comparison
# to see which pair of target sounds are diff from each other?
library(multcomp)
AncovaModel_VOI.CLO <- aov(VOI.CLO ~ target.sound + prev.sound.type + following.sound.type, 
                          data = en03_results_new) # MUST EXECUTE THIS!
postHocs_VOI.CLO <- glht(AncovaModel_VOI.CLO, linfct = mcp(target.sound = "Tukey"))
summary(postHocs_VOI.CLO)

```



(Obsolete) Analyse BUR/CLO.

```{r}
# step1: Levene's test
leveneTest(BUR.CLO~target.sound, en03_results_new)

# step2: ANCOVA test 
AncovaModel_BUR.CLO <- aov(BUR.CLO ~ target.sound + prev.sound.type + following.sound.type, 
                           data = en03_results_new)
Anova(AncovaModel_BUR.CLO, type="III") 

# step3: pairwise comparison
library(multcomp)
AncovaModel_BUR.CLO <- aov(BUR.CLO ~ target.sound + prev.sound.type + following.sound.type, 
                           data = en03_results_new) # MUST EXECUTE THIS!
postHocs_BUR.CLO <- glht(AncovaModel_BUR.CLO, linfct = mcp(target.sound = "Tukey"))
summary(postHocs_BUR.CLO)

```
